<!doctype html>
<html>
<head lang="tr">
    <title>Java 8 Optional ve null dönebilen metotlar</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta name="description" content="Java 8 ile gelen Optional sınıfı kullanımına bir örnek">
    <meta name="keywords"
          content="java,java8,optional">

    <meta name="generator" content="Hugo 0.15" />
    <link rel="stylesheet" type="text/css" href="https://omerozkan.net/css/semantic.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://omerozkan.net/css/style.css">
    <link rel="stylesheet" type="text/css" href="https://omerozkan.net/css/error.css">
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="https://omerozkan.net/js/semantic.min.js"></script>

    <meta name="author" content="Ömer Özkan">

    <meta property="og:site_name" content="Ömer Özkan"/>
    <meta property="og:title" content="Ömer Özkan"/>
    <meta property="og:description" content="Java 8 ile gelen Optional sınıfı kullanımına bir örnek"/>
    <meta property="og:url" content="https://omerozkan.net/java-8-optional/">
    <meta property="og:type" content="blog"/>
    <meta property="og:image" content="java-8-optional.png" />

    
    <link rel="apple-touch-icon" sizes="57x57" href="https://omerozkan.net/img/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://omerozkan.net/img/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://omerozkan.net/img/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://omerozkan.net/img/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://omerozkan.net/img/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://omerozkan.net/img/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://omerozkan.net/img/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://omerozkan.net/img/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://omerozkan.net/img/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="https://omerozkan.net/img/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://omerozkan.net/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="https://omerozkan.net/img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://omerozkan.net/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="https://omerozkan.net/img/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#009688">
    <meta name="msapplication-TileImage" content="https://omerozkan.net/img/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#009688">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#009688">
</head>
<body>
<section id="main">
    <section id="header-container" class="ui grid">
        <header class="ten wide mobile ten wide tablet eight wide computer column centered">
            <div class="row">
                <div class="ui grid">
                    <section id="header"
                             class="ten wide mobile three wide tablet three wide computer centered column">
                        <div class="row">
                            <h1>
                                <a href="https://omerozkan.net/">Ömer Özkan .net</a>
                            </h1>
                        </div>
                    </section>
                    <div class="nine wide computer only column right aligned">
                        <section id="menu" class="row">
                            <nav class="ui teal compact inverted menu">
                                
                                <a href="https://omerozkan.net/hakkimda/" class="link item">
                                    Hakkımda
                                </a>
                                
                                <a href="https://omerozkan.net/kitap-listesi/" class="link item">
                                    Kitap Listesi
                                </a>
                                
                                <a href="https://omerozkan.net/iletisim/" class="link item">
                                    İletişim
                                </a>
                                
                            </nav>
                        </section>
                    </div>
                    <div class="two wide mobile nine wide tablet only column right aligned">
                        <button id="menu-button" class="ui teal icon button" data-transition="overlay">
                            <i id="menu-icon" class="sidebar icon"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>
    </section>

    <nav id="mobile-menu" class="ui right floating sidebar green inverted vertical menu">
        
            <a class="header item" href="https://omerozkan.net/hakkimda/">Hakkımda</a>
        
            <a class="header item" href="https://omerozkan.net/kitap-listesi/">Kitap Listesi</a>
        
            <a class="header item" href="https://omerozkan.net/iletisim/">İletişim</a>
        
        
            <a class="item" href="https://omerozkan.net/kategori/etkinlikler/">Etkinlikler</a>
        
            <a class="item" href="https://omerozkan.net/kategori/genel-konular/">Genel Konular</a>
        
            <a class="item" href="https://omerozkan.net/kategori/java/">Java</a>
        
            <a class="item" href="https://omerozkan.net/kategori/linux/">Linux</a>
        
            <a class="item" href="https://omerozkan.net/kategori/seyir-defteri/">Seyir Defteri</a>
        
            <a class="item" href="https://omerozkan.net/kategori/sunumlar/">Sunumlar</a>
        
            <a class="item" href="https://omerozkan.net/kategori/videolar/">Videolar</a>
        
            <a class="item" href="https://omerozkan.net/kategori/yazilim-metotlari/">Yazılım Metotları</a>
        
    </nav>

    <section id="navbar" class="ui grid">
        <div class="tablet mobile only column empty-nav"></div>
        <nav class="eight wide computer only column centered">
            <div class="ui inverted menu nav-menu">
                
                <a class="item" href="https://omerozkan.net/kategori/etkinlikler/">
                    Etkinlikler
                </a>
                
                <a class="item" href="https://omerozkan.net/kategori/genel-konular/">
                    Genel Konular
                </a>
                
                <a class="item" href="https://omerozkan.net/kategori/java/">
                    Java
                </a>
                
                <a class="item" href="https://omerozkan.net/kategori/linux/">
                    Linux
                </a>
                
                <a class="item" href="https://omerozkan.net/kategori/seyir-defteri/">
                    Seyir Defteri
                </a>
                
                <a class="item" href="https://omerozkan.net/kategori/sunumlar/">
                    Sunumlar
                </a>
                
                <a class="item" href="https://omerozkan.net/kategori/videolar/">
                    Videolar
                </a>
                
                <a class="item" href="https://omerozkan.net/kategori/yazilim-metotlari/">
                    Yazılım Metotları
                </a>
                
            </div>
        </nav>
    </section>
<section id="content-main" class="ui internally grid centered">
    <article class="ten wide mobile ten wide tablet eight wide computer column single">
        <div class="ui basic segment">
            <h1 class="ui green header">Java 8 Optional ve null dönebilen metotlar</h1>
            
            <p class="metadata">
                
                <a class="ui image label">
                    <img src="http://s.gravatar.com/avatar/deb32ea991fee11136e3c72aee30be78?s=150">
                    Ömer Özkan
                </a>
                

                <a class="ui label">
                    <i class="calendar icon"></i>
                    03.06.2016
                </a>
            </p>
            

            <div class="clear"></div>

            
            
            <img class="ui right floated top aligned rounded medium image bordered right"
                 src="https://omerozkan.net/images/thumb/java-8-optional.png"
                 alt="Java 8 Optional ve null dönebilen metotlar"/>
            
            

            <p>Merhabalar, bu yazıda sizlere Java 8 ile beraber gelen Optional sınıfından bahsedeceğim. Bu yazı ile birlikte Java
programlama dili ve teknolojileri konusunda ufak bilgiler paylaşmaya devam edeceğim. Umarım faydalı olur.</p>

<p>Optional sınıfının kullanımına bir örnek vererek anlatacağım. Doğrudan anlatabilecek kadar basit bir sınıf olmasına rağmen
örnek üzerinden gitmenin daha kalıcı olduğunu düşünüyorum. Örneğimizde bir UserRepository sınıfı tasarlayacağız.
Interface&rsquo;imiz şu şekilde:</p>

<div class="clear code"></div>
<script src="//gist.github.com/omerozkan/0ef7a9c175d40cdbea57ea72de25140e.js?file=userRepository1.java"></script>

<p>UserRepository interface&rsquo;inde <code>getByUsername()</code> metodunun tanımlandığını görüyoruz. Adından da anlaşılacağı üzere kullanıcı
adı ile veritabanında kayıtlı bir kullanıcıyı bulmak istiyoruz. Basitçe aşağıdaki implementasyonu yapabiliriz.</p>

<div class="clear code"></div>
<script src="//gist.github.com/omerozkan/0ef7a9c175d40cdbea57ea72de25140e.js?file=userRepositoryImpl1.java"></script>

<p>Herhangi bir persistent api kullanarak kullanıcı listesini aldık. Eğer liste boş dönerse girdiğimiz kullanıcı adına sahip
bir kullanıcı olmadığı anlamına geldiğinden <code>null</code> object döndük. Eğer kullanıcı varsa listenin ilk elemanını dönüyoruz.
Kullandığınız api&rsquo;nin ne olduğunun bir önemi yok. Bundan farklı bir implementasyonda olabilirdi. Burda dikkat etmemiz gereken
eğer veritabanında kullanıcı yoksa ne döneceğimiz. Bu tasarımda <code>null</code> dönmüş olduk.</p>

<p>Başlangıçta tasarım kusursuz görünse de <code>null</code> dönmenin dezavantajları var. Bu sınıfı kullanan istemciye bir sorumluluk yükledik.
İstemci kullanıcıyı sorguladıktan sonra ayrıca bir de <code>null</code>dönüp dönmediğini kontrol etmek zorunda. Aksi takdirde
NullPointerException&rsquo;a sebep olur. Ayrıca bu aslında bir implementasyon detayı. İstemci açısından interface&rsquo;e baktığınızda
aslında <code>null</code> bir değer bekleyemeyiz. Basitçe bir metot var ve kullanıcı adı verip kullanıcı nesnesi alıyoruz. Yani interface
de <code>null</code> obje gelebileceğine dair herhangi bir tanımlama yok. Javadoc veya yorum satırı mı geldi aklınıza? Burdaki javadoc
veya yorum satırı kötü koda sebep olur. Ayrıca kod açısından yine istemciyi bağlayan birşey yok. Bir diğer sorun ise null
dönülmesi bir implementasyon detayı. İmplementasyon yüzünden defensif programlama yapmak zorunda kalıyoruz.</p>

<p>Burdaki durumda aslında kullanıcı nesnesinin <code>null</code> gelebileceğini tahmin edebiliriz. Mantıken baktığınızda kullanıcı
veritabanında yoksa ne olur diye düşündüğünüzde <code>null</code> dönebileceğini anlayabilirsiniz.
Fakat her durumda bu kadar basit bir durumda olmayabilir. Daha karmaşık bir implementasyonda istemci olarak bunu görmek
daha zordur. <code>null</code> dönmek yerine exception kullanarak bir tasarım yapabiliriz:</p>

<div class="clear code"></div>
<script src="//gist.github.com/omerozkan/0ef7a9c175d40cdbea57ea72de25140e.js?file=userRepositoryImpl2.java"></script>

<p>interface&rsquo;i de şu şekilde değiştiriyoruz:</p>

<div class="clear code"></div>
<script src="//gist.github.com/omerozkan/0ef7a9c175d40cdbea57ea72de25140e.js?file=userRepository2.java"></script>

<p>Bu implementasyon yukarıda bahsettiğim sorunu çözüyor. Burada basit bir şekilde kullanıcı yoksa UserNotFoundException&rsquo;u
fırlattık. Ayrıca checked exception olduğundan istemci bu metodu çağırırken exception&rsquo;u handle etmek zorunda veya bir üst
katmana bırakabilir. Sonuç olarak implementasyona bakmadan interface bize exception fırlatabileceğini tanımlar.</p>

<p>Bu tasarımın da yine dezavantajları var. İstemci taraf ya bir try-catch bloğu yazmak zorunda. Yani exception mekanizmasını
bir istisna durumu için değil normal akışın bir parçası olarak kullandık. Burada örneğin veritabanı bağlantısı kesilirse
exception atabilirdik veya istemci geçersiz bir kullanıcı adı gönderdiğinde IllegalArgumentException gibi bir exception
fırlatabilirdik. Fakat burdaki durum ne istemciye bağlı bir input hatası ne de beklenmeyen bir durum. O yüzden bu tarz
yapılarda Exception kullanmamalıyız.</p>

<p>Çözüm olarak yine ilk tasarımımıza dönüp User entity&rsquo;si dönmek yerine bir Result objesi dönebiliriz.</p>

<div class="clear code"></div>
<script src="//gist.github.com/omerozkan/0ef7a9c175d40cdbea57ea72de25140e.js?file=userRepositoryImpl3.java"></script>

<p>User entity&rsquo;sini doğrudan dönmek yerine araya başka bir sınıf yerleştirerek ilk durumdaki sorunu çözmüş oluyoruz. Artık kullanıcının
veritabanında olmayacağını daha net bir şekilde ifade ettik. Bu tür Result sınıflarını immutable tanımlarsak daha iyi bir
tasarım yapmış oluruz. Constructor&rsquo;lara isim veremediğimiz için burada static metod kullanmayı tercih ettim. UserResult sınıfı&rsquo;da aşağıdaki gibi.</p>

<div class="clear code"></div>
<script src="//gist.github.com/omerozkan/0ef7a9c175d40cdbea57ea72de25140e.js?file=userResult.java"></script>

<p>İstemci taraf doesUserExist() metodu ile kontrol edip gereken işlemi yapabilir. Bu şekilde tasarımımız daha stabil oldu.
Àyrıca bunun büyük bir proje olacağını düşünürsek UserResult sınıfını daha generic olarak tasarlayabiliriz.</p>

<div class="clear code"></div>
<script src="//gist.github.com/omerozkan/0ef7a9c175d40cdbea57ea72de25140e.js?file=entityResult.java"></script>

<p>UserRepositoryImpl sınıfımızı da düzenleyelim.</p>

<div class="clear code"></div>
<script src="//gist.github.com/omerozkan/0ef7a9c175d40cdbea57ea72de25140e.js?file=userRepositoryImpl4.java"></script>

<p>EntityResult gibi result objeleri farklı implementasyonlar da içerebilir. Burda <code>null</code>dönme problemini için kullandık.
Özellikle katmanlar arası iletişim bu şekilde yapılmalıdır.</p>

<p>Java7 ile geliştirme yapsaydık eğer muhtemelen bu şekilde geliştirme yapacağız. Fakat Java 8 de bunun için <code>java.util</code>
paketinin içerisinde <code>Optional</code> diye bir sınıf eklendi. Kendi EntityResult gibi sınıflar yazmak yerine null dönebilen
metodlar için return type&rsquo;ı Optional olarak tanımlayabiliriz.</p>

<div class="clear code"></div>
<script src="//gist.github.com/omerozkan/0ef7a9c175d40cdbea57ea72de25140e.js?file=userRepositoryImpl5.java"></script>

<p>Optional yine tasarladığımız EntityResult gibi generic ve immutable bir sınıf. Yine <code>Optional.empty()</code> aynı şekilde boş bir result dönüyor.
<code>null</code> dönebilen yerlerde bunu kullanmalıyız. <code>Optional.of()</code> metodunu da kullanırken dikkatli olmak gerekiyor. Eğer parametre
olarak verdiğiniz objenin değeri <code>null</code> ise NullPointerException alırsınız. Eğer bir nesne <code>null</code> olabilirse `Optional.ofNullable
metodunu kullanın. Diğer metodlarına da kısaca değinirsem:</p>

<ul>
<li><strong>isPresent()</strong> : eğer empty ise false diğer durumda true döner. İlk tasarımımızdaki null kontrolü yerine kullanılabilir.</li>
<li><strong>get()</strong> : Empty olmayan durumlarda Optional içerisinde tanımlanan nesneyi döner. Mutlaka get den önce <code>isPresent()</code> ile kontrol edilmesi
gerekiyor. Aksi takdirde değer empty ise NoSuchElementException alırsınız.</li>
<li><strong>orElse(T value)</strong> : Eğer varsayılan bir değeriniz varsa kullanabilirsiniz. empty ise verdiğiniz değeri, değilse tanımlanan
değeri döner. Örneğin <code>null</code> almak istiyorsanız <code>orElse(null)</code> şeklinde nesneyi alabilirsiniz.</li>
</ul>

<p>Bunun gibi birçok metodu var. Aynı zamanda fonksiyonel özellikler de taşıyor. Java 8 ile beraber gelmesi bir raslantı değil :)
Başlangıçta metodları kullanırken mutlaka javadoc ile inceleyin. <code>get()</code> metodunda olduğu gibi
exception alabilirsiniz. Ayrıca eğer Java 8 de Stream Api ile tanıştıysanız muhtemelen Optional sınıfını kullanmışsınızdır.
Stream Api&rsquo;de oldukça fazla kullanılır. Primitive tipler için de <code>OptionalInt</code>, <code>OptionalDouble</code> gibi sınıfları da kullanabilirsiniz.</p>

<p>Bu yazımda örnek bir tasarım ile Optional sınıfını anlatmaya çalıştım. Umarım faydalı olmuştur.</p>

<p>Bir sonraki yazıda görüşmek üzere&hellip;</p>


            <div class="clear"></div>
            <div class="ui section divider"></div>
            
            
            <div class="ui tag labels">
                
                <span class="ui teal label">
                    java
                </span>
                
                <span class="ui teal label">
                    java8
                </span>
                
                <span class="ui teal label">
                    optional
                </span>
                
            </div>
            

            
            <section id="comment">
                <div class="ui section divider"></div>
                <div id="disqus_thread"></div>
<script>
     var disqus_config = function () {
     this.page.url = 'https:\/\/omerozkan.net\/java-8-optional\/'; 
     this.page.identifier = 'java-8-optional';
     };
    (function() {
        var d = document, s = d.createElement('script');

        var disqus_shortname = 'omerozkan';
        s.src = '//' + disqus_shortname +'.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </section>
            

        </div>

    </article>
</section>
</section>

<section class="footer-container">
    <footer class="ui grid">
        <div class="ten wide mobile ten wide tablet eight wide computer column centered">
            <div class="ui grid">
                <div class="twelve wide mobile two wide tablet two wide computer centered column center aligned">
                    <img id="footer-logo" src="https://omerozkan.net/img/footer-logo.png" alt="Ömer Özkan Logo" class="ui image">
                </div>
                <div class="twelve wide mobile eight wide tablet eight wide computer middle aligned centered column center aligned">
                    © 2008 Ömer Özkan. Tüm hakları saklıdır. <br/><a href="https://omerozkan.net">Ömer Özkan</a> is licensed under a <a
                        href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
                    Commons Attribution-ShareAlike 4.0 International License.</a>
                </div>
                <div class="twelve wide mobile two wide tablet two wide computer middle aligned centered column">
                    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
                        <img id="cc-logo" alt="Creative Commons License" style="border-width:0"
                             class="ui image centered"
                             src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
                </div>
            </div>
        </div>
    </footer>
</section>

<script src="https://omerozkan.net/js/scripts.js"></script>
</body>
</html>